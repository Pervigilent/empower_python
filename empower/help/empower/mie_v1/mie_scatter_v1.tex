\documentclass[12pt]{article}

\usepackage{amsmath}
\usepackage{graphicx}
\usepackage{amsthm}
\usepackage{listings}
\usepackage{xcolor}

%\theoremstyle{definition}
%\newtheorem{example}{Example}[section]

% Custom command for editor
\newcommand{\editor}[1]{\gdef\@editor{#1}}
\newcommand{\printeditor}{%
  \par\vspace{1em}
  \textbf{Editor:} \@editor
}
\makeatletter

\title{Mie Scattering and Absorption (Version 1)}

\author{
  Christian M\"atzler\\[6pt]
  Institute of Applied Physics\\
  University of Bern, Switzerland\\
  \texttt{matzler@iap.unibe.ch}
}

\date{June 2002}

\editor{Stewart Nash}

\begin{document}

\maketitle
\printeditor
\tableofcontents

\begin{abstract}
A set of Mie functions has been developed in Python to compute the four Mie coefficients $a_n$, $b_n$, $c_n$ and $d_n$, efficiencies of extinction, scattering, backscattering and absorption, the asymmetry parameter, and the two angular scattering functions $S_1$ and $S_2$. In addition to the scattered field, also the absolute-square of the internal
field is computed and used to get the absorption efficiency in a way independent from the scattered field. This allows to test the computational accuracy. This first version of MATLAB Mie Functions is limited to homogeneous dielectric spheres without change in the magnetic permeability between the inside and outside of the particle. Required input parameters are the complex refractive index, $m=m'+ im''$, of the sphere (relative to the ambient medium) and the size parameter, $x=ka$, where $a$ is the sphere radius and $k$ the wave number in the ambient medium.
\end{abstract}

\section{Introduction}
This report is a description of Mie-Scattering and Mie-Absorption programs written in the numeric computation and visualisation software, MATLAB (Math Works, 1992), for the improvement of radiative-transfer codes, especially to account for rain and hail in the microwave range and for aerosols and clouds in the submillimeter, infrared and visible range. Excellent descriptions of Mie Scattering were given by van de Hulst (1957) and by Bohren and Huffman (1983). The present programs are related to the formalism of Bohren and Huffman (1983). In addition an extension (Section 2.5) is given to describe the radial dependence of the internal electric field of the scattering sphere and the absorption resulting from this field. Except for Section 2.5, equation numbers refer to those in Bohren and Huffman (1983), in short BH, or in case of missing equation numbers, page numbers are given. For a description of computational problems in the Mie calculations, see the notes on p. 126-129 and in Appendix A of BH.

\section{Formulas for a homogeneous sphere}

\subsection{Mie coefficients and Bessel functions}
Python function: mie\_abcd\\
The key parameters for Mie calculations are the Mie coefficients $a_n$ and $b_n$ to compute the amplitudes of the scattered field, and $c_n$ and $d_n$ for the internal field,
respectively. The computation of these parameters has been the most challenging part in Mie computations due to the involvement of spherical Bessel functions up to
high order. With MATLABâ€™s built-in double-precision Bessel functions, the computation of the Mie coefficients has so far worked well up to size parameters exceeding 10,000; the coefficients are given in BH on p.100:
\begin{align}
	a_n&=\frac{m^2j_n(mx)[xj_n(x)]'-\mu_1j_n(x)[mxj_n(mx)]'}{m^2j_n(mx)[xh_n^{(1)}(x)]'-\mu_1h_n^{(1)}(x)[mxj_n(mx)]'}\\
	b_n&=\frac{\mu_1j_n(mx)[xj_n(x)]'-j_n(x)[mxj_n(mx)]'}{\mu_1j_n(mx)[xh_n^{(1)}(x)]'-h_n^{(1)}(x)[mxj_n(mx)]'}\\
	c_n&=\frac{\mu_1j_n(x)[xh_n^{(1)}(x)]'-\mu_1h_n^{(1)}(x)[xj_n(x)]'}{\mu_1j_n(mx)[xhh_n^{(1)}(x)]'-h_n^{(1)}(x)[mxj_n(mx)]'}\\
	d_n&=\frac{\mu_1mj_n(x)[xh_n^{(1)}(x)]'-\mu_1mh_n^{(1)}(x)[ xj_n(x)]'}{m j_n(mx)[xh_n^{(1)}(x)]'-\mu_1h_n^{(1)}(x)[mxj_n(mx)]'}
	\label{eq:mie_coefficients}
\end{align}
where m is the refractive index of the sphere relative to the ambient medium, $x=ka$ is the size parameter, $a$ the radius of the sphere and $k=2\pi/\lambda$ is the wave number and $\lambda$ the wavelength in the ambient medium. In deviation from BH, $\mu_1$ is the ratio of the magnetic permeability of the sphere to the magnetic permeability of the ambient medium (corresponding to $\mu_1/\mu$ in BH). The functions $j_n(z)$ and $h_n^{(1)}(z)=j_n(z)+iy_n(z)$ are spherical Bessel functions of order $n$ ($n=1,2,\ldots$) and of the given arguments, $z=x$ or $mx$, respectively, and primes mean derivatives with respect to the argument. The derivatives follow from the spherical Bessel functions themselves, namely
\begin{equation}
	\begin{split}
		[zj_n(z)]'&=zj_{n-1}(z)-nj_n(z)\\
		[zh_n^{(1)}(z)]'&=zh_{n-1}^{(1)}(z)-nh_n^{(1)}(z)
	\end{split}
\end{equation}
For completeness, the following relationships between Bessel and spherical Bessel functions are given:
\begin{align}
	j_n(z)&=\sqrt{\frac{\pi}{2z}}J_{n+0.5}(z)\\
	y_n(z)&=\sqrt{\frac{\pi}{2z}}Y_{n+0.5}(z)
\end{align}
Here, $J_\nu$ and $Y_\nu$ are Bessel functions of the first and second kind. For $n=0$ and $1$ the spherical Bessel functions are given (BH, p. 87) by
\begin{equation}
	\begin{split}
		j_0(z)&=\sin{z}/z\\
		j_1(z)&=\sin{z}/z^2-\cos{z}/z\\
		y_0(z)&=-\cos{z}/z\\
		y_1(z)&=-\cos{z}/z^2-\sin{z}/z
	\end{split}
\end{equation}
and the recurrence formula
\begin{equation}
	f_{n-1}(z)+f_{n+1}(z)=\frac{2n+1}{z}f_n(z)
\end{equation}
where $f_n$ is any of the functions $j_n$ and $y_n$. Taylor-series expansions for small arguments of $j_n$ and $y_n$ are given on p. 130 of BH. The spherical Hankel functions are linear combinations of $j_n$ and $y_n$. Here, the first type is required
\begin{equation}
	h_n^{(1)}(z)=j_n(z)+iy_n(z)
\end{equation}
The following related functions are also used in Mie theory (although we try to avoid them here):
\begin{equation}
	\begin{split}
		\psi_n(z)=zj_n(z)\\
		\chi_n(z)=-zy_n(z)\\
		\xi_n(z)=zh_n^{(1)}(z)
	\end{split}
\end{equation}
Often $\mu_1=1$; then, (\ref{eq:mie_coefficients}) simplify to
\begin{align}
	a_n&=\frac{m^2j_n(mx)[xj_n(x)]'-j_n(x)[mxj_n(mx)]'}{m^2j_n(mx)[xh_n^{(1)}(x)]'-h_n^{(1)}(x)[mxj_n(mx)]'}\\
	b_n&=\frac{j_n(mx)[xj_n(x)]'-j_n(x)[mxj_n(mx)]'}{j_n(mx)[xh_n^{(1)}( x)]'-h_n^{(1)}(x)[mxj_n(mx)]'}\\
	c_n&=\frac{j_n(x)[xh_n^{(1)}(x)]'-h_n^{(1)}(x)[xj_n(x)]'}{j_n(mx)[xh_n^{(1)}(x)]'-h_n^{(1)}(x)[mxj_n(mx)]'}\\
	d_n&=\frac{mj_n(x)[xh_n^{(1)}(x)]'-mh_n^{(1)}(x)[xj_n(x)]'}{m^2j_n(mx)[xh_n^{(1)}(x)]'-h_n^{(1)}(x)[mxj_n(mx)]'}
\end{align}
The parameters used in radiative transfer depend on $a_n$ and $b_n$, but not on $c_n$ and $d_n$. The latter coefficients are needed when the electric field inside the sphere is of interest, e.g. to test the field penetration in the sphere, to study the distribution of heat sources or to compute absorption. The absorption efficiency $Q_\mathrm{abs}$, however, can also be computed from the scattered radiation, Equation~\ref{eq:efficiencies} and Equation~\ref{eq:extinction_theorem} to be shown below.

\subsection{Mie efficiencies and cross sections}
Python functions:mie, mie\_xscan
The efficiencies $Q_i$ for the interaction of radiation with a scattering sphere of radius $a$ are cross sections $\sigma_i$ (called $C_i$ in BH) normalised to the particle cross section, ${\pi}a^2$, where $i$ stands for extinction ($i=\mathrm{ext}$), absorption ($i=\mathrm{abs}$), scattering ($i=\mathrm{sca}$), backscattering ($i=\mathrm{b}$), and radiation pressure ($i=\mathrm{pr}$), thus
\begin{equation}
	Q_i=\frac{\sigma_i}{{\pi}a^2}
\end{equation}
Energy conservation requires that
\begin{align}
	Q_\mathrm{ext}&=Q_\mathrm{sca}+Q_\mathrm{abs}\\
	\sigma_\mathrm{ext}&=\sigma_\mathrm{sca}+\sigma_\mathrm{abs}
	\label{eq:efficiencies}
\end{align}
The scattering efficiency $Q_\mathrm{sca}$ follows from the integration of the scattered power over all directions, and the extinction efficiency $Q_\mathrm{ext}$ follows from the Extinction Theorem (Ishimaru, 1978, p. 14, van de Hulst, 1957, p. 31), also called Forward-Scattering Theorem, leading to:
\begin{align}
	Q_\mathrm{sca}&=\frac{2}{x^2}\sum_{n=1}^\infty{(2n+1)(|a_n|^2+|b_n|^2)}\\
	Q_\mathrm{ext}&=\frac{2}{x^2}\sum_{n=1}^\infty{(2n+1)\mathrm{Re}(a_n+b_n)}
	\label{eq:extinction_theorem}
\end{align}
and $Q_\mathrm{abs}$ follows from (\ref{eq:efficiencies}). All infinite series can be truncated after $n_\mathrm{max}$ terms. For this number Bohren and Huffman (1983) proposed the value
\begin{equation}
	n_\mathrm{max}=x+4x^{1/3}+2
\end{equation}
and this value is used here as well.
Furthermore, the asymmetry parameter $g=\langle\cos{\theta}\rangle$ indicates the average cosine of the scattering angle $\theta$ with respect to power; it is used in Two-Stream Models (Meador and Weaver, 1980), and it is related to the efficiency $Q_\mathrm{pr}$ of radiation pressure:
\begin{equation}
	Q_\mathrm{pr}=Q_\mathrm{ext}-Q_\mathrm{sca}\langle\cos{\theta}\rangle
\end{equation}
\begin{equation}
	Q_\mathrm{sca}\langle\cos{\theta}\rangle=\frac{4}{x^2}\left\{\sum_{n=1}^\infty{\frac{n(n+2)}{n+1}\mathrm{Re}(a_na_{n+1}^*+b_nb_{n+1}^*)}+\sum_{n=1}^\infty{\frac{2n+1}{n(n+1)}\mathrm{Re}(a_nb_n^*)}\right\}
\end{equation}
Finally, the backscattering efficiency $Q_b$, applicable to monostatic radar, is given by
\begin{equation}
	Q_\mathrm{b}=\frac{1}{x^2}\left|\sum_{n=1}^\infty{(2n+1)(-1)^n(a_n-b_n)}\right|^2
\end{equation}

\subsection{The scattered far field}
Python functions: mie\_s12, mie\_pt, mie\_thetascan
If the detailed shape of the angular scattering pattern is required, e.g. to get the phase matrix or phase function for radiative-transfer calculations (Chandrasekhar, 1960), the scattering functions $S_1$ and $S_2$ are required. These functions describe the scattered field $\mathbf{E}_\mathrm{s}$. The scattered far field in spherical coordinates ($E_{\mathrm{s}\theta}$, $E_{\mathrm{s}\phi}$) for a unit-amplitude incident field (where the time variation $\exp{(-i{\omega}t)}$ has been omitted) is given by
\begin{align}
	E_{s\theta}&=\frac{e^{ikr}}{-ikr}\cos{\phi}{\cdot}S_2(\cos{\theta})\\
	E_{s\phi}&=\frac{e^{ikr}}{ikr}\sin{\phi}{\cdot}S_1(\cos{\theta})
\end{align}
with the scattering amplitudes $S_1$ and $S_2$
\begin{align}
	S_1(\cos{\theta})&=\sum_{n=1}^\infty{\frac{2n+1}{n(n+1)}(a_n\pi_n+b_n\tau_n)}\\
	S_2(\cos{\theta})&=\sum_{n=1}^\infty{\frac{2n+1}{n(n+1)}(a_n\tau_n+b_n\pi_n)}
\end{align}
$E_{\mathrm{s}\theta}$ is the scattered far-field component in the scattering plane, defined by the incident and scattered directions, and $E_{\mathrm{s}\phi}$ is the orthogonal component. The angle $\phi$ is the angle between the incident electric field and the scattering plane. The functions $\pi_n(\cos{\theta})$ and $\tau_n(\cos{\theta})$ describe the angular scattering patterns of the spherical harmonics used to describe $S_1$ and $S_2$ and follow from the recurrence relations
\begin{equation}
	\begin{split}
		\pi_n&=\frac{2n-1}{n-1}\cos{\theta}\cdot\pi_{n-1}-\frac{n}{n-1}\pi_{n-2}\\
		\tau_n&=n\cos{\theta}\cdot\pi_n-(n+1)\pi_{n-1}
	\end{split}
\end{equation}
starting with (Deirmendjian, 1969, p. 15)
\begin{equation}
	\begin{split}
		\pi_0&=0\\
		\pi_1&=1\\
		\pi_2&=3\cos{\theta}\\
		\tau_0&=0\\
		\tau_1&=\cos{\theta}\\
		\tau_2&=3\cos{2\theta}
	\end{split}
\end{equation}

\subsection{The internal field}
Python function: NONE (see mie\_esquare)
The internal field $\mathbf{E}_1$ for an incident field with unit amplitude is given by
\begin{equation}
	\mathbf{E}_1=\sum_{n=1}^\infty{\frac{2n+1}{n(n+1)}\left(c_n\mathbf{M}_{o1n}^{(1)}-d_n\mathbf{N}_{e1n}^{(1)}\right)}
\end{equation}
where the vector-wave harmonic fields are given in spherical $(r,\theta,\phi)$ coordinates by
\begin{align}
	\mathbf{M}_{o1n}^{(1)}&=
	\begin{pmatrix}
		0\\
		\cos{\phi}\cdot\pi_n(\cos{\theta})j_n(rmx)\\
		-\sin{\phi}\cdot\tau_n(\cos{\theta})j_n(rmx)
	\end{pmatrix}\\
	\mathbf{N}_{e1n}^{(1)}&=
	\begin{pmatrix}
		n(n+1)\cos{\phi}\cdot\sin{\theta}\cdot\pi_n(\cos{\theta})\frac{j_n(rmx)}{rmx}\\
		\cos{\phi}\cdot\tau_n(\cos{\theta})\frac{[rmxj_n(rmx)]'}{rmx}\\
		-\sin{\phi}\cdot\pi_n(\cos{\theta})\frac{[rmxj_n(rmx)]'}{rmx}
	\end{pmatrix}\\
	\label{eq:harmonic_fields}
\end{align}
and the coordinate system is defined as for the scattered field. The vector-wave functions $\mathbf{N}$ and $\mathbf{M}$ are orthogonal with respect to integration over directions. Furthermore for different values of $n$, the $\mathbf{N}$ functions are orthogonal, too, and the same is true for the $\mathbf{M}$ functions.

\subsection{Computation of $Q_\mathrm{abs}$, based on the internal field}
Python functions: mie\_esquare, mie\_abs
The absorption cross section of a particle with dielectric (i.e. Ohmic) losses is given by (Ishimaru, 1978, p. 17)
\begin{equation}
	\sigma_\mathrm{abs}=k\epsilon''\int_V{|\mathbf{E}_1|^2\,dV}	
\end{equation}
where $\epsilon''$ is the imaginary part of the relative dielectric constant of the particle (here with respect to the ambient medium). Thanks to the orthogonality of the spherical vector-wave functions this integral becomes in spherical coordinates
\begin{equation}
	\sigma_\mathrm{abs}=k\epsilon''\pi\sum_{n=1}^\infty{\int_{-1}^{+1}{d(\cos{\theta})}\int_0^a{r^2\,dr}\left(|c_n|^2(m_\theta+m_\phi)+|d_n|^2(n_r+n_\theta+n_\phi)\right)}
	\label{eq:absorption_cross_section}
\end{equation}
and the integration over azimuth $\phi$ has already been performed, leading to the factor $\pi$. The functions in the integrand are absolute-square values of the series terms of the components of the vector-waves (\ref{eq:harmonic_fields})
\begin{equation}
	\begin{split}
		m_\theta&=g_n\pi_n^2(\cos{\theta})\cdot|j_n(z)|^2\\
		m_\phi&=g_n\tau_n^2(\cos{\theta})\cdot|j_n(z)|^2\\
		n_r&=g_n\sin^2{\theta}\cdot\pi_n^2(\cos{\theta})\left|\frac{j_n(z)}{z}\right|^2\\
		n_\theta&=g_n\tau_n^2(\cos{\theta})\left|\frac{(zj_n(z))'}{z}\right|^2\\
		n_\phi&=g_n\pi_n^2(\cos{\theta})\left|\frac{(zj_n(z))'}{z}\right|^2		
	\end{split}
\end{equation}
Here $z=mrk$, and $g_n$ stands for
\begin{equation}
	g_n\left(\frac{2n+1}{n(n+1)}\right)^2
\end{equation}
for the integrals over $\cos{\theta}$, analytic solutions can be obtained. First, from BH we find
\begin{equation}
	\int_{-1}^{-1}{(\pi_n^2(\cos{theta})+(\tau_n^2(\cos{theta}))\,d(\cos{\theta})}=\frac{2n^2(n+1)^2}{2n+1}
\end{equation}
and second, from (4.46) in BH and Equation 8.14.13 of Abramowitz and Stegun
(1965), we get
\begin{equation}
	\begin{split}
		\int_{-1}^{-1}{(\sin^2{\theta}\cdot\pi_n^2(\cos{\theta}))\,d(\cos{\theta})}
		&=\int_{-1}^{-1}{(P_n^1(\cos{\theta}))^2\,d(\cos{\theta})}\\
		&=\frac{2(n+1)}{2n+1}
	\end{split}
\end{equation}
leading to the two parts (\ref{eq:angular_component_m}) and (\ref{eq:angular_component_n}) of the angular integral in (\ref{eq:absorption_cross_section})
\begin{equation}
	\begin{split}
		m_n&=\int_{-1}^1{(m_\theta+m_\phi)\,d(\cos{\theta})}\\
		&=2(2n+1)|j_n(z)|^2
	\end{split}
	\label{eq:angular_component_m}
\end{equation}
\begin{equation}
	\begin{split}
		n_n&=\int_{-1}^1{(n_r+n_\theta+n_\phi)\,d(\cos{\theta})}\\
		&=2n(2n+1)\left\{(n+1)\left|\frac{j_n(z)}{z}\right|^2+\left|\frac{(zj_n(z))'}{z}\right|^2\right\}
	\end{split}
	\label{eq:angular_component_n}
\end{equation}
Now, the absorption cross section follows from integration over the radial distance $r$ inside the sphere up to the sphere radius $a$:
\begin{equation}
	\sigma_\mathrm{abs}=k\epsilon''\pi\sum_{n=1}^\infty{\int_0^a{\left(m_n|c_n|^2+n_n|d_n|^2\right){\cdot}r^2\,dr}}
\end{equation}
The integrand contains the radial dependence of the absolute-square electric field $\langle|\mathbf{E}|^2\rangle$ averaged over spherical shells (all $\theta$ and $\phi$, constant $r$):
\begin{equation}
	\langle|\mathbf{E}|^2\rangle=\frac{1}{4}\sum_{n=1}^\infty{\left(m_n|c_n|^2+n_n|d_n|^2\right)}
	\label{eq:average_electric_field}
\end{equation}
and in terms of this quantity, the absorption efficiency becomes
\begin{equation}
	Q_\mathrm{abs}=\frac{4\epsilon''}{x^2}\int_0^x{\langle|\mathbf{E}|^2\rangle{x'}^2\,dx'}
	\label{eq:absorption_efficiency}
\end{equation}
where $x'=rk=z/m$. Note that (\ref{eq:average_electric_field}) is dimensionless because of the unit-amplitude incident field; In case of Rayleigh scattering ($x{\ll}1$) the internal field is constant, and the corresponding squared-field ratio (\ref{eq:average_electric_field}) is given by
\begin{equation}
	\frac{9}{|m^2+2|^2}
\end{equation}
This quantity can be used to test the accuracy of the function, mie\_esquare, for small size parameters. In addition, Equation~\ref{eq:absorption_efficiency} can be used to test the accuracy of the computation of $Q_\mathrm{abs}$ from the difference, $Q_\mathrm{ext}-Q_\mathrm{sca}$ (\ref{eq:extinction_theorem}). Finally, it should be remembered that all infinite series can be terminated after $n_\mathrm{max}$ terms.

\end{document}

